---
phase: 08-order-history-management
plan: 04
type: execute
wave: 2
depends_on: ["08-01", "08-02"]
files_modified:
  - src/MicroCommerce.Web/src/app/admin/page.tsx
  - src/MicroCommerce.Web/src/components/admin/order-dashboard.tsx
autonomous: true

must_haves:
  truths:
    - "Admin dashboard shows 4 stat cards: Total Orders, Revenue, Average Order Value, Pending Orders"
    - "Admin dashboard shows bar chart of orders per day for last 7 days"
    - "Admin dashboard shows recent orders table below stats"
    - "Admin can switch time range between today, 7d, 30d, all time"
  artifacts:
    - path: "src/MicroCommerce.Web/src/app/admin/page.tsx"
      provides: "Admin dashboard page with stats, chart, and recent orders"
      contains: "useOrderDashboard"
    - path: "src/MicroCommerce.Web/src/components/admin/order-dashboard.tsx"
      provides: "Dashboard stat cards, bar chart, and recent orders table"
      contains: "ChartContainer"
  key_links:
    - from: "admin/page.tsx"
      to: "order-dashboard.tsx"
      via: "component import"
      pattern: "OrderDashboard"
    - from: "order-dashboard.tsx"
      to: "use-orders.ts"
      via: "hook import"
      pattern: "useOrderDashboard"
    - from: "order-dashboard.tsx"
      to: "chart.tsx"
      via: "shadcn/ui chart"
      pattern: "ChartContainer"
---

<objective>
Replace the placeholder admin dashboard with a real dashboard featuring stat cards, an orders-per-day bar chart using shadcn/ui Chart (Recharts), and a recent orders table with time range filtering.

Purpose: Give admins operational visibility into order volume, revenue, and recent activity (ADM-03).
Output: Fully functional admin dashboard with 4 stat cards, bar chart, recent orders table, and time range selector.
</objective>

<execution_context>
@/Users/baotoq/.claude/get-shit-done/workflows/execute-plan.md
@/Users/baotoq/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-order-history-management/08-01-SUMMARY.md
@.planning/phases/08-order-history-management/08-02-SUMMARY.md
@src/MicroCommerce.Web/src/app/admin/page.tsx
@src/MicroCommerce.Web/src/hooks/use-orders.ts
@src/MicroCommerce.Web/src/components/ui/chart.tsx
@src/MicroCommerce.Web/src/lib/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build dashboard component with stat cards, bar chart, and recent orders table</name>
  <files>
    src/MicroCommerce.Web/src/components/admin/order-dashboard.tsx
  </files>
  <action>
    Create "use client" component `OrderDashboard`:

    **State:** `timeRange` (string, default "today"). Render a select/dropdown for time range: "Today", "Last 7 Days", "Last 30 Days", "All Time" mapping to "today", "7d", "30d", "all".

    **Data:** Use `useOrderDashboard(timeRange)` and `useAllOrders({ pageSize: 10 })` hooks.

    **Section 1: Stat Cards** (4-column grid, responsive to 2-col on medium, 1-col on small):
    - **Total Orders:** ShoppingCart icon (lucide), `dashboard.totalOrders` formatted as number
    - **Revenue:** DollarSign icon, `dashboard.revenue` formatted as USD currency using `Intl.NumberFormat`
    - **Average Order Value:** TrendingUp icon, `dashboard.averageOrderValue` formatted as USD
    - **Pending Orders:** Clock icon, `dashboard.pendingOrders` formatted as number

    Each card uses shadcn/ui `Card`, `CardHeader`, `CardTitle`, `CardContent`. Small icon in header row, large value in content.

    **Section 2: Orders Per Day Chart:**
    - Use shadcn/ui `ChartContainer` with `ChartConfig`:
      ```typescript
      const chartConfig = {
        count: { label: "Orders", color: "hsl(var(--chart-1))" },
      } satisfies ChartConfig;
      ```
    - Inside ChartContainer: Recharts `BarChart` with `data={dashboard.ordersPerDay}`:
      - `XAxis` dataKey="date" with tick formatter to show short date (e.g., "Feb 3")
      - `YAxis` with allowDecimals={false}
      - `ChartTooltip` with `ChartTooltipContent`
      - `Bar` dataKey="count" fill="var(--color-count)" radius={4}
    - Wrap in a Card with title "Orders Per Day (Last 7 Days)"
    - Min height 300px for the chart

    **Section 3: Recent Orders Table:**
    - Use shadcn/ui `Table`, `TableHeader`, `TableBody`, `TableRow`, `TableHead`, `TableCell`
    - Columns: Order Number, Status (Badge), Total (USD formatted), Items, Date
    - Use data from `useAllOrders` (first 10 orders)
    - Each row links to `/admin/orders/{id}` (admin order detail, built in plan 05)
    - Status badges with same color scheme as storefront (Submitted=yellow, Confirmed=blue, Paid=green, Shipped=purple, Delivered=green, Failed=red)
    - Wrap in a Card with title "Recent Orders"

    **Loading state:** Show Skeleton components for each section while data loads.
    **Empty state:** If no orders, show "No orders yet" in place of chart and table.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Component imports ChartContainer, BarChart, useOrderDashboard, useAllOrders
    - Component renders 4 stat cards, bar chart, and table
  </verify>
  <done>Dashboard component renders stat cards with icons, bar chart via shadcn/ui Chart/Recharts, recent orders table with status badges, and time range selector.</done>
</task>

<task type="auto">
  <name>Task 2: Replace admin dashboard page with real dashboard</name>
  <files>
    src/MicroCommerce.Web/src/app/admin/page.tsx
  </files>
  <action>
    Replace the existing placeholder admin page (`export default function AdminDashboard()`) with:

    ```tsx
    "use client";

    import { OrderDashboard } from "@/components/admin/order-dashboard";

    export default function AdminDashboardPage() {
      return (
        <div>
          <h1 className="text-2xl font-bold text-gray-900 mb-6">Dashboard</h1>
          <OrderDashboard />
        </div>
      );
    }
    ```

    The page is now a client component (needs "use client" since OrderDashboard uses hooks). The heading stays consistent with existing admin pages.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Admin page.tsx imports and renders OrderDashboard component
    - Visit /admin shows real dashboard instead of placeholder text
  </verify>
  <done>Admin dashboard page renders real stats, chart, and recent orders table. Placeholder text is replaced.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` -- no type errors
2. Visit /admin -> see 4 stat cards with real data
3. Bar chart shows orders per day for last 7 days
4. Recent orders table shows 10 most recent orders with status badges
5. Time range selector switches between today/7d/30d/all and data updates
6. Loading state shows skeletons, empty state shows appropriate message
</verification>

<success_criteria>
- ADM-03: Admin dashboard shows today's orders, total revenue, average order value, pending orders
- Bar chart visualizes order volume over last 7 days
- Time range picker allows switching between today, 7d, 30d, all time
- Recent orders table provides quick access to individual orders
</success_criteria>

<output>
After completion, create `.planning/phases/08-order-history-management/08-04-SUMMARY.md`
</output>
