---
phase: 10-testing-polish
plan: 06
type: execute
wave: 3
depends_on: ["10-01", "10-02", "10-03", "10-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "App handles API errors gracefully with user-friendly messages (not raw stack traces)"
    - "Loading states display skeleton placeholders while data fetches"
    - "Empty states show helpful messages when no data exists (empty cart, no orders, no products)"
    - "Error boundaries catch unexpected errors and show recovery UI"
    - "All unit and integration tests pass together as a full suite"
  artifacts: []
  key_links: []
---

<objective>
Audit and polish the frontend UX across storefront and admin: error handling, loading states, empty states, and overall robustness. Then run the full test suite (unit + integration) to verify everything works together. Conclude with a human verification checkpoint.

Purpose: Production readiness polish - ensure the app handles edge cases gracefully. Users see helpful messages instead of blank screens or cryptic errors. Loading states provide visual feedback during data fetches.
Output: Improved error handling, loading states, and empty states across the most impactful areas of the storefront and admin UI.
</objective>

<execution_context>
@/Users/baotoq/.claude/get-shit-done/workflows/execute-plan.md
@/Users/baotoq/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-testing-polish/10-01-SUMMARY.md
@.planning/phases/10-testing-polish/10-04-SUMMARY.md

@src/MicroCommerce.Web/src/app/(storefront)/layout.tsx
@src/MicroCommerce.Web/src/app/(storefront)/page.tsx
@src/MicroCommerce.Web/src/app/(storefront)/cart/page.tsx
@src/MicroCommerce.Web/src/app/(storefront)/orders/page.tsx
@src/MicroCommerce.Web/src/app/(storefront)/checkout/page.tsx
@src/MicroCommerce.Web/src/app/(storefront)/error.tsx
@src/MicroCommerce.Web/src/app/admin/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and improve UX across storefront and admin</name>
  <files>
    Files determined by audit - likely modifying existing page/component files
  </files>
  <action>
    Perform a UX audit of the storefront and admin, then fix the most impactful gaps. Focus on these categories:

    **1. Error Handling:**
    - Verify `error.tsx` exists at `(storefront)/error.tsx` - check it shows a user-friendly error with "Try Again" button, not a raw error message
    - Check if `not-found.tsx` exists for 404 handling at the app level and storefront route group
    - Verify API error responses are caught and displayed as toast notifications or inline messages (not console-only)
    - Check checkout page handles submission errors gracefully (show error message, don't lose form data)
    - Check admin pages handle API failures (show error states, not blank screens)

    **2. Loading States:**
    - Verify product grid has skeleton loading (already done per decisions, but confirm quality)
    - Check product detail page has loading skeleton
    - Check cart page has loading state
    - Check order history page has loading state
    - Check admin dashboard has loading skeletons for stat cards and chart
    - Check admin order pages have loading states
    - Add `loading.tsx` files for route segments that don't have them (Next.js Suspense boundary)

    **3. Empty States:**
    - Cart page: "Your cart is empty" with link to browse products
    - Order history: "No orders yet" with link to browse products
    - Admin orders: "No orders found" for filtered results
    - Product search: "No products match your search" when filter returns empty
    - Admin categories: Empty state if no categories exist

    **4. Quick Wins:**
    - Ensure all interactive buttons have appropriate cursor and hover states
    - Verify form inputs have proper error state styling (red border, error message below)
    - Check that disabled buttons look visually distinct
    - Ensure toast notifications are used consistently for success/error actions

    For each area, audit the current implementation first (read the file), then make targeted fixes. Do NOT rewrite entire components - make surgical improvements. Prioritize by impact:
    1. Error handling that prevents blank screens (HIGH)
    2. Empty states for common scenarios (MEDIUM)
    3. Loading state improvements (MEDIUM)
    4. Visual polish (LOW)

    Document which improvements were made and which were already adequate.
  </action>
  <verify>
    All modified files compile: `cd src/MicroCommerce.Web && npm run build` succeeds (or `npx next lint` at minimum).
    No TypeScript errors introduced.
  </verify>
  <done>
    Storefront and admin UX audited. Error handling catches API failures gracefully. Empty states provide helpful messages for cart, orders, and search. Loading states use skeleton placeholders. No blank screens or raw error messages visible to users.
  </done>
</task>

<task type="auto">
  <name>Task 2: Run full test suite and verify all tests pass together</name>
  <files>
    No files modified - verification task
  </files>
  <action>
    Run the complete test suite to verify all unit and integration tests pass together:

    1. Run all unit tests:
       ```bash
       dotnet test src/MicroCommerce.ApiService.Tests/ --filter "Category=Unit" --verbosity normal
       ```
       Verify all pass. Note the count.

    2. Run all integration tests (requires Docker):
       ```bash
       dotnet test src/MicroCommerce.ApiService.Tests/ --filter "Category=Integration" --verbosity normal
       ```
       Verify all pass. Note the count.

    3. Run all tests together:
       ```bash
       dotnet test src/MicroCommerce.ApiService.Tests/ --verbosity normal
       ```
       Verify total count and all pass.

    4. Run tests with coverage:
       ```bash
       dotnet test src/MicroCommerce.ApiService.Tests/ --collect:"XPlat Code Coverage" --settings src/MicroCommerce.ApiService.Tests/coverlet.runsettings
       ```
       Note coverage percentage for Ordering domain (target: 80%+).

    5. Verify frontend builds:
       ```bash
       cd src/MicroCommerce.Web && npm run build
       ```

    If any tests fail, fix them. Common issues:
    - Database state leaking between integration tests (add cleanup)
    - Port conflicts with Testcontainers (ensure Docker is running)
    - Missing service registrations in WebApplicationFactory (add stubs)
  </action>
  <verify>
    `dotnet test src/MicroCommerce.ApiService.Tests/ --verbosity normal` shows ALL tests pass (0 failed).
    `cd src/MicroCommerce.Web && npm run build` succeeds.
  </verify>
  <done>
    Full test suite passes: unit tests (70+), integration tests (20+), all green. Frontend builds without errors after UX improvements. Coverage data collected for Ordering domain.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete test suite (unit + integration + E2E setup) and UX polish for MicroCommerce:
    - Unit tests for all 4 domain aggregates (Order, Product, Cart, StockItem) and value objects
    - FluentValidation validator tests
    - CheckoutStateMachine saga tests
    - Integration tests for all API endpoints with real PostgreSQL (Testcontainers)
    - Playwright E2E test configuration with browsing and cart tests
    - UX improvements: error handling, loading states, empty states
  </what-built>
  <how-to-verify>
    1. Run the full backend test suite:
       ```bash
       dotnet test src/MicroCommerce.ApiService.Tests/ --verbosity normal
       ```
       Expected: All tests pass (90+ tests, 0 failures)

    2. Start the full Aspire stack and browse the app:
       ```bash
       dotnet run --project src/MicroCommerce.AppHost
       ```
       - Visit the storefront homepage, verify products load with skeletons
       - Visit /cart with empty cart, verify empty state message
       - Add a product to cart, verify feedback
       - Visit /orders without login, verify appropriate messaging
       - Visit admin dashboard, verify loading states

    3. (Optional) Run E2E tests if stack is running:
       ```bash
       cd src/MicroCommerce.Web && npm run test:e2e
       ```

    4. Verify error handling: try accessing a non-existent product URL - should show 404 or error page, not blank screen
  </how-to-verify>
  <resume-signal>Type "approved" if tests pass and UX looks good, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `dotnet test src/MicroCommerce.ApiService.Tests/` - ALL tests pass
2. `cd src/MicroCommerce.Web && npm run build` - No errors
3. No blank screens or raw error messages visible in storefront or admin
4. Empty cart, no orders, no search results all show helpful messages
5. Loading states visible during data fetches
</verification>

<success_criteria>
- Full test suite passes (90+ tests across unit and integration)
- Frontend builds cleanly after UX improvements
- Error handling covers API failures, 404s, and unexpected errors
- Empty states exist for cart, orders, search results
- Loading states use skeleton placeholders
- Human verification confirms acceptable quality
</success_criteria>

<output>
After completion, create `.planning/phases/10-testing-polish/10-06-SUMMARY.md`
</output>
