---
phase: 14.1-check-ddd-approach-correctness
plan: 02
type: execute
wave: 2
depends_on: ["14.1-01"]
files_modified:
  - .planning/phases/14.1-check-ddd-approach-correctness/14.1-DDD-FINDINGS-WIP.md
  - .planning/phases/14.1-check-ddd-approach-correctness/14.1-DDD-AUDIT-REPORT.md
autonomous: true

must_haves:
  truths:
    - "All 7 feature modules audited with equal scrutiny"
    - "Bounded context isolation analyzed across the entire codebase"
    - "CQRS patterns validated across all modules"
    - "Final report has executive summary with key findings"
    - "Each finding cites the DDD principle or reference material"
  artifacts:
    - path: ".planning/phases/14.1-check-ddd-approach-correctness/14.1-DDD-AUDIT-REPORT.md"
      provides: "Complete DDD audit report with all 7 modules plus cross-cutting analysis"
      contains: "## Executive Summary"
  key_links:
    - from: "14.1-DDD-FINDINGS-WIP.md"
      to: "14.1-DDD-AUDIT-REPORT.md"
      via: "WIP findings merged with remaining module audits into final report"
      pattern: "## Executive Summary"
---

<objective>
Audit the remaining 4 feature modules (Cart, Inventory, Profiles, Reviews, Wishlists), perform cross-cutting bounded context isolation analysis, and compile the complete DDD audit report with executive summary.

Purpose: Complete the full-codebase DDD audit by covering the remaining modules and cross-cutting concerns (bounded context leakage, CQRS consistency, naming/ubiquitous language). Produce the final deliverable -- a structured report actionable enough for a separate fix phase.

Output: `.planning/phases/14.1-check-ddd-approach-correctness/14.1-DDD-AUDIT-REPORT.md` -- the complete audit report.
</objective>

<execution_context>
@/Users/baotoq/.claude/get-shit-done/workflows/execute-plan.md
@/Users/baotoq/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/14.1-check-ddd-approach-correctness/14.1-CONTEXT.md
@.planning/phases/14.1-check-ddd-approach-correctness/14.1-RESEARCH.md
@.planning/phases/14.1-check-ddd-approach-correctness/14.1-01-SUMMARY.md
@.planning/phases/14.1-check-ddd-approach-correctness/14.1-DDD-FINDINGS-WIP.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit Cart, Inventory, Profiles, Reviews, and Wishlists modules</name>
  <files>.planning/phases/14.1-check-ddd-approach-correctness/14.1-DDD-FINDINGS-WIP.md</files>
  <action>
Read and analyze the remaining 5 feature modules:

**Cart module (Domain: 4, Application: 14, Infra: 4):**
- `src/MicroCommerce.ApiService/Features/Cart/Domain/Entities/Cart.cs`
- `src/MicroCommerce.ApiService/Features/Cart/Domain/Entities/CartItem.cs`
- `src/MicroCommerce.ApiService/Features/Cart/Domain/ValueObjects/CartId.cs`
- `src/MicroCommerce.ApiService/Features/Cart/Domain/ValueObjects/CartItemId.cs`
- All Application/Commands and Application/Queries files
- `src/MicroCommerce.ApiService/Features/Cart/BuyerIdentity.cs`
- `src/MicroCommerce.ApiService/Features/Cart/Infrastructure/CartDbContext.cs`
- `src/MicroCommerce.ApiService/Features/Cart/Infrastructure/CartExpirationService.cs`
- `src/MicroCommerce.ApiService/Features/Cart/Infrastructure/Configurations/*.cs`
- `src/MicroCommerce.ApiService/Features/Cart/CartEndpoints.cs`

**Inventory module (Domain: 11, Application: 17, Infra: 5):**
- All Domain files (StockItem, StockAdjustment, StockReservation entities; events; value objects)
- All Application files (Commands, Queries, Consumers/ProductCreatedConsumer)
- `src/MicroCommerce.ApiService/Features/Inventory/Infrastructure/InventoryDbContext.cs`
- `src/MicroCommerce.ApiService/Features/Inventory/Infrastructure/ReservationCleanupService.cs`
- `src/MicroCommerce.ApiService/Features/Inventory/Infrastructure/Configurations/*.cs`
- `src/MicroCommerce.ApiService/Features/Inventory/InventoryEndpoints.cs`

**Profiles module (Domain: 7, Application: 12, Infra: 3):**
- All Domain files (UserProfile entity; events; value objects: Address, AddressId, DisplayName, UserProfileId)
- All Application files (Commands: AddAddress, CreateProfile, DeleteAddress, RemoveAvatar, SetDefaultAddress, UpdateAddress, UpdateProfile, UploadAvatar; Queries: GetProfile)
- `src/MicroCommerce.ApiService/Features/Profiles/Infrastructure/ProfilesDbContext.cs`
- `src/MicroCommerce.ApiService/Features/Profiles/Infrastructure/AvatarImageService.cs`
- `src/MicroCommerce.ApiService/Features/Profiles/Infrastructure/Configurations/UserProfileConfiguration.cs`
- `src/MicroCommerce.ApiService/Features/Profiles/ProfilesEndpoints.cs`

**Reviews module (Domain: 7, Application: 8, Infra: 2):**
- All Domain files (Review entity; events; value objects: Rating, ReviewId, ReviewText)
- All Application files (Commands: CreateReview, DeleteReview, UpdateReview; Queries: CheckUserPurchased, GetReviewsByProduct, GetUserReviewForProduct)
- `src/MicroCommerce.ApiService/Features/Reviews/Infrastructure/ReviewsDbContext.cs`
- `src/MicroCommerce.ApiService/Features/Reviews/Infrastructure/Configurations/ReviewConfiguration.cs`
- `src/MicroCommerce.ApiService/Features/Reviews/ReviewsEndpoints.cs`

**Wishlists module (Domain: 2, Application: 5, Infra: 2):**
- All Domain files (WishlistItem entity; WishlistItemId value object)
- All Application files (Commands: AddToWishlist, RemoveFromWishlist; Queries: GetUserWishlist, GetWishlistCount, GetWishlistProductIds)
- `src/MicroCommerce.ApiService/Features/Wishlists/Infrastructure/WishlistsDbContext.cs`
- `src/MicroCommerce.ApiService/Features/Wishlists/Infrastructure/Configurations/WishlistItemConfiguration.cs`
- `src/MicroCommerce.ApiService/Features/Wishlists/WishlistsEndpoints.cs`

For each module, audit against the same 8 pattern categories from 14.1-RESEARCH.md:
1. Aggregate root design (Vernon's 4 rules)
2. Entity vs value object distinction
3. Strongly-typed IDs
4. Repository pattern / data access
5. Domain events
6. Bounded context isolation
7. CQRS with MediatR
8. Vertical slice architecture integration

Also check for anti-patterns: anemic domain model, large aggregates, shared kernel violations, cross-aggregate transactions, primitive obsession.

Pay special attention to:
- Cart: Does Cart aggregate properly manage CartItems through the root? Guest identity pattern.
- Inventory: StockItem aggregate with reservations -- are reservation operations going through the aggregate root?
- Profiles: UserProfile with Address collection -- is Address properly modeled as value object or entity?
- Reviews: Cross-context dependency on Ordering (purchase verification) -- how is this handled?
- Wishlists: Is WishlistItem properly an entity or should it be modeled differently? Cross-context product data queries.

Append sections `## Cart Module`, `## Inventory Module`, `## Profiles Module`, `## Reviews Module`, `## Wishlists Module` to the existing `14.1-DDD-FINDINGS-WIP.md`. Same format: severity-tagged findings with issue, principle, and reference.
  </action>
  <verify>
`14.1-DDD-FINDINGS-WIP.md` now contains sections for all 7 modules plus BuildingBlocks/Common:
- `## BuildingBlocks/Common Foundation` (from Plan 01)
- `## Catalog Module` (from Plan 01)
- `## Ordering Module` (from Plan 01)
- `## Cart Module` (this task)
- `## Inventory Module` (this task)
- `## Profiles Module` (this task)
- `## Reviews Module` (this task)
- `## Wishlists Module` (this task)
  </verify>
  <done>All 5 remaining feature modules audited with findings documented, each tagged by severity and citing DDD principles</done>
</task>

<task type="auto">
  <name>Task 2: Cross-cutting analysis and compile final DDD audit report</name>
  <files>.planning/phases/14.1-check-ddd-approach-correctness/14.1-DDD-AUDIT-REPORT.md</files>
  <action>
Perform cross-cutting analysis across all modules, then compile the final report.

**Cross-cutting analysis:**

1. **Bounded Context Isolation**: Search for cross-context violations:
   - Grep for imports/usings that reference other feature module namespaces (e.g., `using MicroCommerce.ApiService.Features.Catalog` inside Ordering handlers)
   - Check if any DbContext queries data from another module's tables
   - Check if domain entities from one module are used in another module's Application layer
   - Check if event contracts share domain models or use separate DTOs
   - Check DependencyInjection.cs files in each feature module for cross-context service registrations

2. **CQRS Consistency**: Across all modules, verify:
   - Commands return minimal data (ID or void), not full entities/DTOs
   - Queries are read-only (no SaveChangesAsync calls)
   - Commands modify state through aggregate methods, not direct property setting
   - Handlers are stateless and focused

3. **Ubiquitous Language**: Check naming consistency:
   - Are domain terms used consistently across modules?
   - Any generic names (Manager, Service, Processor) where domain terms would be better?
   - Same business concept named differently across features?

4. **Pattern Consistency**: Are the same DDD patterns applied consistently across v1.0 (Catalog, Cart, Ordering, Inventory) and v1.1 (Profiles, Reviews, Wishlists) modules? Flag any divergence.

**Compile final report:**

Create `14.1-DDD-AUDIT-REPORT.md` with this structure:

```markdown
# DDD Tactical Patterns Audit Report

**Date:** [today]
**Scope:** Full codebase audit -- BuildingBlocks/Common + 7 feature modules
**Reference Standard:** Modern .NET DDD (eShopOnContainers, Clean Architecture, MediatR patterns)

## Executive Summary

[2-3 paragraph summary of key findings. No numeric scoring per user decision. Highlight the most impactful issues across the codebase. Note any systemic patterns vs isolated issues.]

## Cross-Cutting Findings

### Bounded Context Isolation
[Findings about cross-context violations, shared models, leaky boundaries]

### CQRS Patterns
[Findings about command/query separation consistency]

### Ubiquitous Language
[Findings about naming consistency and domain vocabulary]

### Pattern Consistency
[Findings about divergence between v1.0 and v1.1 modules]

## Module Findings

### BuildingBlocks/Common Foundation
[Findings from WIP file, reformatted if needed]

### Catalog
[Findings from WIP file]

### Ordering
[Findings from WIP file]

### Cart
[Findings from WIP file]

### Inventory
[Findings from WIP file]

### Profiles
[Findings from WIP file]

### Reviews
[Findings from WIP file]

### Wishlists
[Findings from WIP file]

## References

[List of DDD sources cited throughout the report]
```

Each finding within module sections follows the format:
### [Severity] Finding title
- **Issue:** What is wrong
- **Principle:** DDD principle violated
- **Reference:** Source citation

Severity levels:
- **Critical**: Breaks DDD invariants (e.g., aggregate boundaries violated, domain events published before persistence)
- **Warning**: Deviates from best practice (e.g., anemic methods, primitive obsession in specific spots)
- **Info**: Could be improved (e.g., naming suggestions, minor structural improvements)

The report must be actionable enough that a separate fix phase can work through findings module by module.
  </action>
  <verify>
`14.1-DDD-AUDIT-REPORT.md` exists and contains:
- Executive summary (no numeric scoring)
- Cross-cutting findings section (bounded context isolation, CQRS, ubiquitous language, pattern consistency)
- Module findings for all 7 modules plus BuildingBlocks/Common (8 sections total)
- Every finding has severity, issue, principle, and reference
- Issues only -- no "things done well"
- No before/after code examples
- References section listing cited DDD sources
  </verify>
  <done>Complete DDD audit report delivered with executive summary, cross-cutting analysis, and per-module findings covering all 7 feature modules and BuildingBlocks/Common foundation</done>
</task>

</tasks>

<verification>
- `14.1-DDD-AUDIT-REPORT.md` is the final deliverable in the phase directory
- Report covers all 7 feature modules with equal scrutiny (per user decision)
- Bounded context isolation analysis included (per user decision)
- CQRS patterns validated (per user decision)
- Executive summary present without numeric scoring (per user decision)
- Each finding cites DDD principle or reference material (per user decision)
- Issues only -- no "things done well" documented (per user decision)
- No before/after code examples (per user decision)
- Report is actionable for a future fix phase (per user decision)
</verification>

<success_criteria>
- All 7 feature modules + BuildingBlocks/Common audited across all DDD tactical pattern categories
- Cross-cutting analysis completed for bounded context isolation, CQRS consistency, ubiquitous language
- Final report structured by module with severity-tagged findings
- Executive summary highlights systemic issues vs isolated findings
- Report actionable enough for module-by-module remediation in a future phase
</success_criteria>

<output>
After completion, create `.planning/phases/14.1-check-ddd-approach-correctness/14.1-02-SUMMARY.md`
</output>
