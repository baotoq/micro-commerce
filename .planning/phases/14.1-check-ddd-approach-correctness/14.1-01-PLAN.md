---
phase: 14.1-check-ddd-approach-correctness
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/14.1-check-ddd-approach-correctness/14.1-DDD-FINDINGS-WIP.md
autonomous: true

must_haves:
  truths:
    - "BuildingBlocks/Common base classes audited against modern .NET DDD reference patterns"
    - "Catalog module audited for all DDD tactical patterns with findings tagged by severity"
    - "Ordering module audited for all DDD tactical patterns with findings tagged by severity"
    - "Each finding describes the issue and cites the DDD principle violated"
  artifacts:
    - path: ".planning/phases/14.1-check-ddd-approach-correctness/14.1-DDD-FINDINGS-WIP.md"
      provides: "Interim findings report covering BuildingBlocks, Common, Catalog, and Ordering"
      contains: "## BuildingBlocks/Common Foundation"
  key_links:
    - from: "14.1-RESEARCH.md"
      to: "14.1-DDD-FINDINGS-WIP.md"
      via: "Audit checklists from research applied to actual code"
      pattern: "Critical|Warning|Info"
---

<objective>
Audit DDD tactical patterns in the foundational BuildingBlocks/Common layer plus the two most complex feature modules (Catalog and Ordering). Write interim findings to a work-in-progress report.

Purpose: These three areas contain the richest DDD patterns in the codebase -- aggregate roots, domain events, sagas, value objects, strongly-typed IDs, and CQRS handlers. Auditing them first establishes the baseline for how the foundation is used (or misused) by the most complex modules.

Output: `.planning/phases/14.1-check-ddd-approach-correctness/14.1-DDD-FINDINGS-WIP.md` with findings for BuildingBlocks/Common, Catalog, and Ordering modules.
</objective>

<execution_context>
@/Users/baotoq/.claude/get-shit-done/workflows/execute-plan.md
@/Users/baotoq/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14.1-check-ddd-approach-correctness/14.1-CONTEXT.md
@.planning/phases/14.1-check-ddd-approach-correctness/14.1-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit BuildingBlocks/Common foundation and Catalog module</name>
  <files>.planning/phases/14.1-check-ddd-approach-correctness/14.1-DDD-FINDINGS-WIP.md</files>
  <action>
Read and analyze the following source files systematically:

**BuildingBlocks/Common (11 files):**
- `src/BuildingBlocks/BuildingBlocks.Common/BaseAggregateRoot.cs`
- `src/BuildingBlocks/BuildingBlocks.Common/IAggregateRoot.cs`
- `src/BuildingBlocks/BuildingBlocks.Common/ValueObject.cs`
- `src/BuildingBlocks/BuildingBlocks.Common/StronglyTypedId.cs`
- `src/BuildingBlocks/BuildingBlocks.Common/DependencyInjection.cs`
- `src/BuildingBlocks/BuildingBlocks.Common/Events/IDomainEvent.cs`
- `src/BuildingBlocks/BuildingBlocks.Common/Events/DomainEvent.cs`
- `src/BuildingBlocks/BuildingBlocks.Common/Events/EventId.cs`
- `src/BuildingBlocks/BuildingBlocks.Common/Events/IDomainEventDispatcher.cs`
- `src/BuildingBlocks/BuildingBlocks.Common/Events/IDomainEventHandler.cs`
- `src/BuildingBlocks/BuildingBlocks.Common/Events/MediatorDomainEventDispatcher.cs`

**Common infrastructure (key files):**
- `src/MicroCommerce.ApiService/Common/Persistence/DomainEventInterceptor.cs`
- `src/MicroCommerce.ApiService/Common/Persistence/OutboxDbContext.cs`
- `src/MicroCommerce.ApiService/Common/Behaviors/ValidationBehavior.cs`
- `src/MicroCommerce.ApiService/Common/Exceptions/*.cs`

**Catalog module (all Domain, Application, Infrastructure non-migration files):**
- All files in `src/MicroCommerce.ApiService/Features/Catalog/Domain/` (Entities, Events, ValueObjects)
- All files in `src/MicroCommerce.ApiService/Features/Catalog/Application/` (Commands, Queries)
- `src/MicroCommerce.ApiService/Features/Catalog/Infrastructure/CatalogDbContext.cs`
- `src/MicroCommerce.ApiService/Features/Catalog/Infrastructure/Configurations/*.cs`
- `src/MicroCommerce.ApiService/Features/Catalog/Infrastructure/ImageUploadService.cs`
- `src/MicroCommerce.ApiService/Features/Catalog/CatalogEndpoints.cs`

For each area, audit against the 8 pattern categories from 14.1-RESEARCH.md:
1. Aggregate root design (Vernon's 4 rules)
2. Entity vs value object distinction
3. Strongly-typed IDs
4. Repository pattern / data access
5. Domain events
6. Bounded context isolation
7. CQRS with MediatR
8. Vertical slice architecture integration

Also check for anti-patterns: anemic domain model, large aggregates, shared kernel violations, cross-aggregate transactions, primitive obsession.

For each finding:
- Tag severity: **Critical** (breaks DDD invariants), **Warning** (deviates from best practice), **Info** (could be improved)
- Describe the issue concisely (what is wrong)
- Cite the DDD principle or reference (from 14.1-RESEARCH.md sources)
- Do NOT describe things done well -- issues only
- Do NOT provide before/after code examples

Write findings to `14.1-DDD-FINDINGS-WIP.md` with this structure:

```markdown
# DDD Audit Findings (Work in Progress)

## BuildingBlocks/Common Foundation

### [Severity] Finding title
- **Issue:** Description of what is wrong
- **Principle:** DDD principle violated
- **Reference:** Source citation

## Catalog Module

### [Severity] Finding title
...
```
  </action>
  <verify>
File `.planning/phases/14.1-check-ddd-approach-correctness/14.1-DDD-FINDINGS-WIP.md` exists and contains:
- A `## BuildingBlocks/Common Foundation` section with findings
- A `## Catalog Module` section with findings
- Each finding has severity tag, issue description, principle, and reference
- No "things done well" sections -- issues only
  </verify>
  <done>BuildingBlocks/Common and Catalog module audited with all findings documented, each tagged by severity and citing DDD principles</done>
</task>

<task type="auto">
  <name>Task 2: Audit Ordering module and append to findings</name>
  <files>.planning/phases/14.1-check-ddd-approach-correctness/14.1-DDD-FINDINGS-WIP.md</files>
  <action>
Read and analyze the Ordering module source files:

**Ordering module Domain (10 files):**
- `src/MicroCommerce.ApiService/Features/Ordering/Domain/Entities/Order.cs`
- `src/MicroCommerce.ApiService/Features/Ordering/Domain/Entities/OrderItem.cs`
- `src/MicroCommerce.ApiService/Features/Ordering/Domain/Events/OrderFailedDomainEvent.cs`
- `src/MicroCommerce.ApiService/Features/Ordering/Domain/Events/OrderPaidDomainEvent.cs`
- `src/MicroCommerce.ApiService/Features/Ordering/Domain/Events/OrderSubmittedDomainEvent.cs`
- `src/MicroCommerce.ApiService/Features/Ordering/Domain/ValueObjects/OrderId.cs`
- `src/MicroCommerce.ApiService/Features/Ordering/Domain/ValueObjects/OrderItemId.cs`
- `src/MicroCommerce.ApiService/Features/Ordering/Domain/ValueObjects/OrderNumber.cs`
- `src/MicroCommerce.ApiService/Features/Ordering/Domain/ValueObjects/OrderStatus.cs`
- `src/MicroCommerce.ApiService/Features/Ordering/Domain/ValueObjects/ShippingAddress.cs`

**Ordering module Application (27 files):**
- All Command handlers (SubmitOrder, SimulatePayment, UpdateOrderStatus)
- All Query handlers (GetOrderById, GetAllOrders, GetOrdersByBuyer, GetOrderDashboard)
- All Consumers (ClearCart, ConfirmOrder, DeductStock, OrderFailed, OrderSubmitted, ReleaseStockReservations, ReserveStockForOrder)
- Saga files (CheckoutState, CheckoutStateMachine, Contracts)

**Ordering module Infrastructure (non-migration):**
- `src/MicroCommerce.ApiService/Features/Ordering/Infrastructure/OrderingDbContext.cs`
- `src/MicroCommerce.ApiService/Features/Ordering/Infrastructure/Configurations/OrderConfiguration.cs`
- `src/MicroCommerce.ApiService/Features/Ordering/Infrastructure/Configurations/OrderItemConfiguration.cs`
- `src/MicroCommerce.ApiService/Features/Ordering/Infrastructure/Configurations/CheckoutStateConfiguration.cs`
- `src/MicroCommerce.ApiService/Features/Ordering/OrderingEndpoints.cs`

Apply the same 8 pattern categories plus anti-pattern checks from Task 1.

Pay special attention to:
- The checkout saga (CheckoutStateMachine) -- is it properly using domain events and maintaining saga state?
- Cross-aggregate coordination between Ordering and Inventory contexts via consumers
- Whether commands mutate through the Order aggregate root or bypass it
- Order aggregate invariant protection (e.g., can Order be in invalid state?)
- OrderItem as child entity -- is it properly managed through the aggregate root?

Append `## Ordering Module` section to the existing `14.1-DDD-FINDINGS-WIP.md` file. Same format: severity-tagged findings with issue, principle, and reference.
  </action>
  <verify>
File `.planning/phases/14.1-check-ddd-approach-correctness/14.1-DDD-FINDINGS-WIP.md` now contains three sections:
- `## BuildingBlocks/Common Foundation` (from Task 1)
- `## Catalog Module` (from Task 1)
- `## Ordering Module` (from this task)
Each finding has severity, issue, principle, and reference.
  </verify>
  <done>Ordering module fully audited including saga, consumers, and aggregate patterns with findings appended to the work-in-progress report</done>
</task>

</tasks>

<verification>
- `14.1-DDD-FINDINGS-WIP.md` exists in the phase directory
- Contains findings for BuildingBlocks/Common, Catalog, and Ordering
- Every finding has severity (Critical/Warning/Info), issue description, DDD principle, and reference citation
- No "things done well" documented -- issues only
- No before/after code examples
- Findings are grouped by module
</verification>

<success_criteria>
- All BuildingBlocks/Common base classes analyzed against modern .NET DDD patterns
- Catalog module audited across all 8 DDD pattern categories
- Ordering module audited across all 8 DDD pattern categories including saga patterns
- Each finding is actionable enough that a future fix phase can address it by module
</success_criteria>

<output>
After completion, create `.planning/phases/14.1-check-ddd-approach-correctness/14.1-01-SUMMARY.md`
</output>
