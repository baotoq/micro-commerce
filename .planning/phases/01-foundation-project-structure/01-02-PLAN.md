---
phase: 01-foundation-project-structure
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - code/MicroCommerce.ApiService/Features/Catalog/Infrastructure/CatalogDbContext.cs
  - code/MicroCommerce.ApiService/Features/Cart/Infrastructure/CartDbContext.cs
  - code/MicroCommerce.ApiService/Features/Ordering/Infrastructure/OrderingDbContext.cs
  - code/MicroCommerce.ApiService/Features/Inventory/Infrastructure/InventoryDbContext.cs
  - code/MicroCommerce.ApiService/Features/Catalog/Domain/.gitkeep
  - code/MicroCommerce.ApiService/Features/Catalog/Application/.gitkeep
  - code/MicroCommerce.ApiService/Features/Cart/Domain/.gitkeep
  - code/MicroCommerce.ApiService/Features/Cart/Application/.gitkeep
  - code/MicroCommerce.ApiService/Features/Ordering/Domain/.gitkeep
  - code/MicroCommerce.ApiService/Features/Ordering/Application/.gitkeep
  - code/MicroCommerce.ApiService/Features/Inventory/Domain/.gitkeep
  - code/MicroCommerce.ApiService/Features/Inventory/Application/.gitkeep
autonomous: true

must_haves:
  truths:
    - "Each module has Domain/, Application/, Infrastructure/ folder structure"
    - "Each module has its own DbContext with schema isolation"
    - "DbContexts are registered in DI and can be resolved"
  artifacts:
    - path: "code/MicroCommerce.ApiService/Features/Catalog/Infrastructure/CatalogDbContext.cs"
      provides: "Catalog module DbContext with 'catalog' schema"
      contains: "HasDefaultSchema"
    - path: "code/MicroCommerce.ApiService/Features/Cart/Infrastructure/CartDbContext.cs"
      provides: "Cart module DbContext with 'cart' schema"
      contains: "HasDefaultSchema"
    - path: "code/MicroCommerce.ApiService/Features/Ordering/Infrastructure/OrderingDbContext.cs"
      provides: "Ordering module DbContext with 'ordering' schema"
      contains: "HasDefaultSchema"
    - path: "code/MicroCommerce.ApiService/Features/Inventory/Infrastructure/InventoryDbContext.cs"
      provides: "Inventory module DbContext with 'inventory' schema"
      contains: "HasDefaultSchema"
  key_links:
    - from: "code/MicroCommerce.ApiService/Features/*/Infrastructure/*DbContext.cs"
      to: "DbContext base class"
      via: "EF Core inheritance"
      pattern: "class.*DbContext.*:.*DbContext"
---

<objective>
Create the modular monolith folder structure with Clean Architecture layers and initialize DbContexts for each module with PostgreSQL schema isolation.

Purpose: Establish the physical structure that developers will copy when creating new modules, with proper database isolation from day one.
Output: Features/ folder with 4 modules (Catalog, Cart, Ordering, Inventory), each with Domain/, Application/, Infrastructure/ layers and a DbContext.
</objective>

<execution_context>
@/Users/baotoq/.claude/get-shit-done/workflows/execute-plan.md
@/Users/baotoq/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-project-structure/01-CONTEXT.md
@.planning/phases/01-foundation-project-structure/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create module folder structure</name>
  <files>
code/MicroCommerce.ApiService/Features/Catalog/Domain/.gitkeep
code/MicroCommerce.ApiService/Features/Catalog/Application/.gitkeep
code/MicroCommerce.ApiService/Features/Catalog/Infrastructure/.gitkeep
code/MicroCommerce.ApiService/Features/Cart/Domain/.gitkeep
code/MicroCommerce.ApiService/Features/Cart/Application/.gitkeep
code/MicroCommerce.ApiService/Features/Cart/Infrastructure/.gitkeep
code/MicroCommerce.ApiService/Features/Ordering/Domain/.gitkeep
code/MicroCommerce.ApiService/Features/Ordering/Application/.gitkeep
code/MicroCommerce.ApiService/Features/Ordering/Infrastructure/.gitkeep
code/MicroCommerce.ApiService/Features/Inventory/Domain/.gitkeep
code/MicroCommerce.ApiService/Features/Inventory/Application/.gitkeep
code/MicroCommerce.ApiService/Features/Inventory/Infrastructure/.gitkeep
  </files>
  <action>
Create the Features/ folder structure under MicroCommerce.ApiService with all four modules:

```
Features/
├── Catalog/
│   ├── Domain/
│   ├── Application/
│   └── Infrastructure/
├── Cart/
│   ├── Domain/
│   ├── Application/
│   └── Infrastructure/
├── Ordering/
│   ├── Domain/
│   ├── Application/
│   └── Infrastructure/
└── Inventory/
    ├── Domain/
    ├── Application/
    └── Infrastructure/
```

Create empty .gitkeep files in Domain/ and Application/ folders to preserve the structure in git (Infrastructure/ will have DbContext files).

Use `mkdir -p` commands to create the directory structure.
  </action>
  <verify>
Run `ls -la code/MicroCommerce.ApiService/Features/` - should show Catalog, Cart, Ordering, Inventory folders.
Run `ls -la code/MicroCommerce.ApiService/Features/Catalog/` - should show Domain, Application, Infrastructure folders.
  </verify>
  <done>
All 4 modules have Domain/, Application/, Infrastructure/ folder structure.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create module DbContexts with schema isolation</name>
  <files>
code/MicroCommerce.ApiService/Features/Catalog/Infrastructure/CatalogDbContext.cs
code/MicroCommerce.ApiService/Features/Cart/Infrastructure/CartDbContext.cs
code/MicroCommerce.ApiService/Features/Ordering/Infrastructure/OrderingDbContext.cs
code/MicroCommerce.ApiService/Features/Inventory/Infrastructure/InventoryDbContext.cs
  </files>
  <action>
Create a DbContext for each module with PostgreSQL schema isolation. Each DbContext:
- Inherits from DbContext
- Has its own schema (catalog, cart, ordering, inventory)
- Uses separate migrations history table per schema
- Applies configurations only from its own namespace
- Has placeholder comment for MassTransit outbox entities (added in Plan 04)

**CatalogDbContext.cs:**
```csharp
using Microsoft.EntityFrameworkCore;

namespace MicroCommerce.ApiService.Features.Catalog.Infrastructure;

public class CatalogDbContext : DbContext
{
    public CatalogDbContext(DbContextOptions<CatalogDbContext> options)
        : base(options)
    {
    }

    // DbSets will be added as entities are created
    // public DbSet<Product> Products => Set<Product>();

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        base.OnModelCreating(modelBuilder);

        // Schema isolation
        modelBuilder.HasDefaultSchema("catalog");

        // Apply configurations from Catalog module only
        modelBuilder.ApplyConfigurationsFromAssembly(
            typeof(CatalogDbContext).Assembly,
            t => t.Namespace?.Contains("Features.Catalog") == true);

        // MassTransit outbox entities will be added in Plan 04
    }
}
```

Create similar DbContexts for Cart (schema: "cart"), Ordering (schema: "ordering"), and Inventory (schema: "inventory").

Each should follow the exact same pattern but with its own schema name and namespace filter.
  </action>
  <verify>
Run `dotnet build code/MicroCommerce.ApiService/MicroCommerce.ApiService.csproj` - should compile (may need Plan 01 packages first, but structure is valid).
Grep for "HasDefaultSchema" in all DbContext files to verify schema isolation is configured.
  </verify>
  <done>
Each module has a DbContext with its own PostgreSQL schema configured.
  </done>
</task>

</tasks>

<verification>
1. `ls -R code/MicroCommerce.ApiService/Features/` shows complete structure
2. Each *DbContext.cs file contains `HasDefaultSchema` with correct schema name
3. Files are syntactically correct C# (no compile errors when packages available)
</verification>

<success_criteria>
- Features/ folder exists with Catalog, Cart, Ordering, Inventory modules
- Each module has Domain/, Application/, Infrastructure/ folders
- Each module has a DbContext with schema isolation (catalog, cart, ordering, inventory)
- Structure is ready for developers to copy as template for new modules
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-project-structure/01-02-SUMMARY.md`
</output>
