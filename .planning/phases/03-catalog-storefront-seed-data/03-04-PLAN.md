---
phase: 03-catalog-storefront-seed-data
plan: 04
type: execute
wave: 2
depends_on: ["03-02"]
files_modified:
  - code/MicroCommerce.Web/src/app/(storefront)/products/[id]/page.tsx
  - code/MicroCommerce.Web/src/components/storefront/product-detail.tsx
  - code/MicroCommerce.Web/src/components/storefront/related-products.tsx
autonomous: true

must_haves:
  truths:
    - "User clicks a product card and sees a detail page with full product info"
    - "Product detail shows large image, name, description, price, category, and SKU"
    - "Page shows 4 related products from the same category"
    - "Add to Cart button is present (non-functional until Cart phase)"
  artifacts:
    - path: "code/MicroCommerce.Web/src/app/(storefront)/products/[id]/page.tsx"
      provides: "Product detail route page"
      min_lines: 20
    - path: "code/MicroCommerce.Web/src/components/storefront/product-detail.tsx"
      provides: "Product detail content layout"
      min_lines: 50
    - path: "code/MicroCommerce.Web/src/components/storefront/related-products.tsx"
      provides: "Related products section from same category"
      min_lines: 30
  key_links:
    - from: "src/app/(storefront)/products/[id]/page.tsx"
      to: "/api/catalog/products/{id}"
      via: "getProductById fetch"
      pattern: "getProductById"
    - from: "src/components/storefront/related-products.tsx"
      to: "/api/catalog/products"
      via: "getProducts with categoryId filter"
      pattern: "getProducts|getStorefrontProducts"
---

<objective>
Build the product detail page with full product information and related products section.

Purpose: Fulfills CAT-02 -- user can view a product detail page with full info. This is where users evaluate products before adding to cart. The related products section encourages discovery.
Output: Product detail page at /products/[id] showing image, name, description, price, category, SKU, Add to Cart button, and 4 related products from the same category.
</objective>

<execution_context>
@/Users/baotoq/.claude/get-shit-done/workflows/execute-plan.md
@/Users/baotoq/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-catalog-storefront-seed-data/03-CONTEXT.md
@.planning/phases/03-catalog-storefront-seed-data/03-RESEARCH.md
@.planning/phases/03-catalog-storefront-seed-data/03-02-SUMMARY.md

@code/MicroCommerce.Web/src/lib/api.ts
@code/MicroCommerce.Web/src/app/(storefront)/layout.tsx
@code/MicroCommerce.Web/next.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create product detail page and components</name>
  <files>
    code/MicroCommerce.Web/src/app/(storefront)/products/[id]/page.tsx
    code/MicroCommerce.Web/src/components/storefront/product-detail.tsx
    code/MicroCommerce.Web/src/components/storefront/related-products.tsx
  </files>
  <action>
    1. **Create `src/components/storefront/product-detail.tsx`:**
       - `"use client"` component accepting `productId: string` prop
       - Fetches product via `getProductById(productId)` on mount
       - Layout: Image left (60% width) / Info right (40%) on desktop, stacked on mobile
       - Image: Large `next/image` with fill in aspect-ratio container, handle missing image with placeholder
       - Info section contains:
         - Category name as a small link/badge
         - Product name (large heading, `text-3xl font-bold`)
         - Price formatted with `Intl.NumberFormat`
         - Description (multi-line, `text-muted-foreground`)
         - SKU if present (small muted text: "SKU: LAP-001")
         - "Add to Cart" button (large, primary style). Non-functional -- on click show toast via sonner: "Cart coming soon!"
       - Loading state: skeleton layout matching the detail structure
       - Error state: "Product not found" message with link back to homepage
       - Apple Store aesthetic: generous whitespace, clean typography, large product image

    2. **Create `src/components/storefront/related-products.tsx`:**
       - `"use client"` component accepting `categoryId: string` and `currentProductId: string` props
       - Fetches products with `getProducts({ categoryId, status: 'Published', pageSize: 5 })`
       - Filters out current product from results, takes first 4
       - Renders "More from [Category]" heading with a horizontal row of 4 ProductCard components
       - If no related products, render nothing (don't show empty section)
       - Layout: grid with 2 cols on mobile, 4 on desktop
       - Loading state: 4 ProductCardSkeleton components

    3. **Create `src/app/(storefront)/products/[id]/page.tsx`:**
       - Route page that extracts `id` from params
       - Renders ProductDetail with the id
       - Below that, a Separator, then RelatedProducts section
       - Wrap in max-w-7xl mx-auto container with appropriate padding
       - Add breadcrumb: Home > Products > [Product Name] (can be simple text links)

    The detail page should feel spacious and premium. The product image should be the hero of the page.
  </action>
  <verify>
    `cd code/MicroCommerce.Web && npm run build` succeeds. Read products/[id]/page.tsx to confirm it renders ProductDetail and RelatedProducts. Read product-detail.tsx to confirm image layout, price formatting, Add to Cart button with toast, loading/error states.
  </verify>
  <done>
    Navigating to /products/{id} shows product detail with large image, name, price, description, SKU, category, and Add to Cart button. Below shows 4 related products from the same category. Loading shows skeleton. Invalid ID shows error.
  </done>
</task>

</tasks>

<verification>
- `npm run build` succeeds
- /products/[id] renders full product detail
- Image fills left side on desktop, stacks on mobile
- Price formatted with currency symbol
- Add to Cart button shows toast "Cart coming soon!"
- Related products section shows 4 items from same category
- Loading skeleton displays while fetching
</verification>

<success_criteria>
- Product detail page renders all product fields (image, name, description, price, category, SKU)
- Layout is responsive (side-by-side desktop, stacked mobile)
- Add to Cart button present with placeholder toast
- Related products load from same category (excluding current product)
- Error handling for invalid product IDs
</success_criteria>

<output>
After completion, create `.planning/phases/03-catalog-storefront-seed-data/03-04-SUMMARY.md`
</output>
