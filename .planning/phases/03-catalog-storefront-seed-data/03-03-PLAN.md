---
phase: 03-catalog-storefront-seed-data
plan: 03
type: execute
wave: 2
depends_on: ["03-02"]
files_modified:
  - code/MicroCommerce.Web/src/components/storefront/product-card.tsx
  - code/MicroCommerce.Web/src/components/storefront/product-grid.tsx
  - code/MicroCommerce.Web/src/hooks/use-intersection-observer.ts
  - code/MicroCommerce.Web/src/app/(storefront)/page.tsx
  - code/MicroCommerce.Web/src/lib/api.ts
autonomous: true

must_haves:
  truths:
    - "User sees a responsive grid of product cards with image, name, price, and category badge"
    - "Scrolling to the bottom loads more products automatically (infinite scroll)"
    - "Product cards show hover effect with quick Add to Cart button overlay"
    - "Out-of-stock products appear greyed out with Out of Stock badge"
    - "Loading shows skeleton cards, not a spinner"
  artifacts:
    - path: "code/MicroCommerce.Web/src/components/storefront/product-card.tsx"
      provides: "Individual product card with image, name, price, category badge, hover overlay"
      min_lines: 40
    - path: "code/MicroCommerce.Web/src/components/storefront/product-grid.tsx"
      provides: "Grid container with infinite scroll logic"
      min_lines: 60
    - path: "code/MicroCommerce.Web/src/hooks/use-intersection-observer.ts"
      provides: "Reusable intersection observer hook for infinite scroll"
      min_lines: 15
  key_links:
    - from: "src/components/storefront/product-grid.tsx"
      to: "/api/catalog/products"
      via: "fetch with page parameter incremented on scroll"
      pattern: "getProducts|fetch.*products"
    - from: "src/components/storefront/product-grid.tsx"
      to: "src/hooks/use-intersection-observer.ts"
      via: "hook triggers next page load"
      pattern: "useIntersectionObserver"
    - from: "src/components/storefront/product-card.tsx"
      to: "src/lib/api.ts"
      via: "uses ProductDto type"
      pattern: "ProductDto"
---

<objective>
Build the product grid with individual product cards and infinite scroll for the storefront homepage.

Purpose: This is the core browsing experience -- CAT-01 requirement. Users see products in a responsive grid that loads more as they scroll. Product cards show the essential info (image, name, price, category) with a premium hover effect.
Output: Working product grid on homepage with infinite scroll, skeleton loading, and Apple Store-aesthetic product cards.
</objective>

<execution_context>
@/Users/baotoq/.claude/get-shit-done/workflows/execute-plan.md
@/Users/baotoq/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-catalog-storefront-seed-data/03-CONTEXT.md
@.planning/phases/03-catalog-storefront-seed-data/03-RESEARCH.md
@.planning/phases/03-catalog-storefront-seed-data/03-02-SUMMARY.md

@code/MicroCommerce.Web/src/lib/api.ts
@code/MicroCommerce.Web/src/app/(storefront)/page.tsx
@code/MicroCommerce.Web/src/components/storefront/header.tsx
@code/MicroCommerce.Web/next.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create product card component</name>
  <files>
    code/MicroCommerce.Web/src/components/storefront/product-card.tsx
  </files>
  <action>
    Create a `ProductCard` component (`"use client"`) that displays a single product:

    1. **Image area:** Use `next/image` with `fill` inside a fixed-aspect-ratio container (4:3 or 1:1). Use the shadcn aspect-ratio component or a Tailwind aspect-ratio class. Handle missing images with a placeholder gradient background.
    2. **Category badge:** Small badge (shadcn Badge component or custom) showing category name, positioned above or below the image.
    3. **Product name:** Truncated to 2 lines max (`line-clamp-2`).
    4. **Price:** Formatted with `Intl.NumberFormat('en-US', { style: 'currency', currency: product.priceCurrency })`.
    5. **Hover overlay:** On card hover (`group-hover`), show a semi-transparent overlay with an "Add to Cart" button. Button is non-functional (shows toast "Cart coming soon!" via sonner). Use Tailwind `group` and `group-hover` classes for pure CSS animation.
    6. **Out-of-stock state:** If product status is not "Published" (though storefront should only get Published), apply greyed-out styling with "Out of Stock" badge overlay. This is future-proofing for Inventory phase.
    7. **Link:** Entire card is wrapped in a Next.js `Link` to `/products/{product.id}`.
    8. **Skeleton variant:** Export a `ProductCardSkeleton` component that mimics the card layout with shadcn Skeleton components for loading state.

    Apple Store aesthetic: White card background, subtle shadow on hover (`shadow-sm` -> `shadow-md` transition), rounded corners, clean typography.

    Props: `product: ProductDto` (from api.ts types).
  </action>
  <verify>
    `cd code/MicroCommerce.Web && npm run build` succeeds. Read the file to confirm: next/image usage, price formatting with Intl, hover overlay with Add to Cart, Link to product detail, skeleton variant exported.
  </verify>
  <done>
    ProductCard renders product image, name, price, category badge. Hover shows Add to Cart overlay. ProductCardSkeleton provides loading state.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create intersection observer hook and product grid with infinite scroll</name>
  <files>
    code/MicroCommerce.Web/src/hooks/use-intersection-observer.ts
    code/MicroCommerce.Web/src/components/storefront/product-grid.tsx
    code/MicroCommerce.Web/src/app/(storefront)/page.tsx
    code/MicroCommerce.Web/src/lib/api.ts
  </files>
  <action>
    1. **Create `src/hooks/use-intersection-observer.ts`:**
       - Custom hook that returns a ref and isIntersecting boolean
       - Uses native IntersectionObserver API
       - Accepts options: threshold (default 0.1), rootMargin (default "100px")
       - Cleans up observer on unmount

    2. **Add `getStorefrontProducts` to `src/lib/api.ts`:**
       - A convenience function that wraps `getProducts` with `status: 'Published'` always set
       - Accepts same params as getProducts minus status
       - Also add `sortBy` and `sortDirection` to `GetProductsParams` interface

    3. **Create `src/components/storefront/product-grid.tsx`:**
       - `"use client"` component
       - State: products array, page number, loading, hasMore
       - On mount: fetch first page (pageSize=12, status=Published) using getStorefrontProducts
       - Renders grid: `grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6`
       - At bottom of grid: sentinel div observed by useIntersectionObserver
       - When sentinel is visible AND hasMore AND NOT loading: fetch next page, append to products array
       - hasMore = totalCount > products.length
       - Loading state: show 8 ProductCardSkeleton components on initial load, 4 at bottom during page load
       - Empty state: "No products found" message
       - Accept optional props for filtering: `categoryId`, `search`, `sortBy`, `sortDirection` -- when these change, reset products and page to 1 and refetch
       - Use a single useEffect that triggers on [page, categoryId, search, sortBy, sortDirection]

    4. **Update `src/app/(storefront)/page.tsx`:**
       - Replace the placeholder products section with the actual ProductGrid component
       - Keep the hero banner above
       - Add a section with id="products" containing a heading "All Products" and the ProductGrid
       - Add `max-w-7xl mx-auto px-4 sm:px-6 lg:px-8` container for content width

    IMPORTANT: Always pass `status: 'Published'` when fetching for storefront. Never show Draft or Archived products.
  </action>
  <verify>
    `cd code/MicroCommerce.Web && npm run build` succeeds. Read product-grid.tsx to confirm: infinite scroll with intersection observer, skeleton loading, status=Published filter, grid responsive classes. Read api.ts to confirm sortBy/sortDirection added to GetProductsParams.
  </verify>
  <done>
    Homepage shows responsive product grid that loads 12 products at a time. Scrolling to bottom loads more. Skeleton cards show during loading. Only Published products displayed.
  </done>
</task>

</tasks>

<verification>
- `npm run build` succeeds
- Product cards show image, name, price, category badge
- Grid is responsive (1 col mobile, 2 sm, 3 lg, 4 xl)
- Infinite scroll loads more products on scroll
- Skeleton cards appear during loading
- Only Published products are fetched
</verification>

<success_criteria>
- ProductCard shows all required info with hover overlay
- ProductGrid implements infinite scroll with Intersection Observer
- Skeleton loading (not spinner) for initial and subsequent page loads
- Grid responsive across breakpoints
- Homepage renders hero + product grid seamlessly
</success_criteria>

<output>
After completion, create `.planning/phases/03-catalog-storefront-seed-data/03-03-SUMMARY.md`
</output>
