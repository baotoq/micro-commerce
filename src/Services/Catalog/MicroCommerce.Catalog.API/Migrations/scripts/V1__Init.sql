CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    migration_id character varying(150) NOT NULL,
    product_version character varying(32) NOT NULL,
    CONSTRAINT pk___ef_migrations_history PRIMARY KEY (migration_id)
);

START TRANSACTION;

CREATE TABLE categories (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    name text NULL,
    CONSTRAINT pk_categories PRIMARY KEY (id)
);

CREATE TABLE products (
    id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    name text NULL,
    price numeric NOT NULL,
    stock_quantity integer NOT NULL,
    description text NULL,
    image_uri text NULL,
    CONSTRAINT pk_products PRIMARY KEY (id)
);

CREATE TABLE category_product (
    categories_id integer NOT NULL,
    products_id bigint NOT NULL,
    CONSTRAINT pk_category_product PRIMARY KEY (categories_id, products_id),
    CONSTRAINT fk_category_product_categories_categories_id FOREIGN KEY (categories_id) REFERENCES categories (id) ON DELETE CASCADE,
    CONSTRAINT fk_category_product_products_products_id FOREIGN KEY (products_id) REFERENCES products (id) ON DELETE CASCADE
);

CREATE INDEX ix_category_product_products_id ON category_product (products_id);

INSERT INTO "__EFMigrationsHistory" (migration_id, product_version)
VALUES ('20210104170353_Init', '5.0.1');

COMMIT;
